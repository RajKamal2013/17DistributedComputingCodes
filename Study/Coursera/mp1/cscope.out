cscope 15 /Users/rajkamal/Documents/work/CloudComputing/Coursera/mp1 -q 0000000302 0000028281
	@Application.cpp

7 
	~"AµliÿtiÚ.h
"

9 
	$hªdËr
(
sig
) {

10 *
¬¿y
[10];

11 
size_t
 
size
;

14 
size
 = 
	`backŒaû
(
¬¿y
, 10);

17 
	`årštf
(
¡d”r
, "E¼Ü: sigÇÈ%d:\n", 
sig
);

18 
	`backŒaû_symbŞs_fd
(
¬¿y
, 
size
, 
STDERR_FILENO
);

19 
	`ex™
(1);

20 
	}
}

27 
	$maš
(
¬gc
, *
¬gv
[]) {

29 iàĞ
¬gc
 !ğ
ARGS_COUNT
 ) {

30 
cout
<<"CÚfigu¿tiÚ (i.e., *.cÚfèfFRequœed"<<
’dl
;

31  
FAILURE
;

35 
AµliÿtiÚ
 *
­p
 = 
Ãw
 
	`AµliÿtiÚ
(
¬gv
[1]);

37 
­p
->
	`run
();

39 
	`d–‘e
(
­p
);

41  
SUCCESS
;

42 
	}
}

47 
	gAµliÿtiÚ
::
	$AµliÿtiÚ
(*
šfe
) {

48 
i
;

49 
·r
 = 
Ãw
 
	`P¬ams
();

50 
	`¤ªd
 (
	`time
(
NULL
));

51 
·r
->
	`£¬ams
(
šfe
);

52 
log
 = 
Ãw
 
	`Log
(
·r
);

53 
’
 = 
Ãw
 
	`EmulN‘
(
·r
);

54 
mp1
 = (
MP1Node
 **è
	`m®loc
(
·r
->
EN_GPSZ
 * (MP1Node *));

59  
i
 = 0; i < 
·r
->
EN_GPSZ
; i++ ) {

60 
Memb”
 *
memb”Node
 = 
Ãw
 Member;

61 
memb”Node
->
š™ed
 = 
çl£
;

62 
Add»ss
 *
add»ssOfMemb”Node
 = 
Ãw
 
	`Add»ss
();

63 
Add»ss
 
jošaddr
;

64 
jošaddr
 = 
	`g‘jošaddr
();

65 
add»ssOfMemb”Node
 = (
Add»ss
 *è
’
->
	`ENš™
×dd»ssOfMemb”Node, 
·r
->
PORTNUM
);

66 
mp1
[
i
] = 
Ãw
 
	`MP1Node
(
memb”Node
, 
·r
, 
’
, 
log
, 
add»ssOfMemb”Node
);

67 
log
->
	`LOG
(&(
mp1
[
i
]->
	`g‘Memb”Node
()->
addr
), "APP");

68 
d–‘e
 
add»ssOfMemb”Node
;

70 
	}
}

75 
	gAµliÿtiÚ
::~
	$AµliÿtiÚ
() {

76 
d–‘e
 
log
;

77 
d–‘e
 
’
;

78  
i
 = 0; i < 
·r
->
EN_GPSZ
; i++ ) {

79 
d–‘e
 
mp1
[
i
];

81 
	`ä“
(
mp1
);

82 
d–‘e
 
·r
;

83 
	}
}

90 
	gAµliÿtiÚ
::
	$run
()

92 
i
;

93 
timeWh’AÎNodesHaveJošed
 = 0;

95 
boŞ
 
®lNodesJošed
 = 
çl£
;

96 
	`¤ªd
(
	`time
(
NULL
));

99  
·r
->
glob®time
 = 0;…¬->glob®tim< 
TOTAL_RUNNING_TIME
; ++par->globaltime ) {

101 
	`mp1Run
();

103 
	`ç
();

107 
’
->
	`ENş—nup
();

109 
i
=0;i<=
·r
->
EN_GPSZ
-1;i++) {

110 
mp1
[
i
]->
	`fšishUpThisNode
();

113  
SUCCESS
;

114 
	}
}

121 
	gAµliÿtiÚ
::
	$mp1Run
() {

122 
i
;

125  
i
 = 0; i <ğ
·r
->
EN_GPSZ
-1; i++) {

130 ifĞ
·r
->
	`g‘cu¼time
(è> ()Õ¬->
STEP_RATE
*
i
è&& !(
mp1
[i]->
	`g‘Memb”Node
()->
bFaed
) ) {

132 
mp1
[
i
]->
	`»cvLoİ
();

138  
i
 = 
·r
->
EN_GPSZ
 - 1; i >= 0; i-- ) {

143 ifĞ
·r
->
	`g‘cu¼time
(è=ğ()Õ¬->
STEP_RATE
*
i
) ) {

145 
mp1
[
i
]->
	`nodeS¹
(
JOINADDR
, 
·r
->
PORTNUM
);

146 
cout
<<
i
<<"-th iÁroduûd‚odi assigÃd w™hhadd»ss: "<<
mp1
[i]->
	`g‘Memb”Node
()->
addr
.
	`g‘Add»ss
(è<< 
’dl
;

147 
nodeCouÁ
 +ğ
i
;

153 ifĞ
·r
->
	`g‘cu¼time
(è> ()Õ¬->
STEP_RATE
*
i
è&& !(
mp1
[i]->
	`g‘Memb”Node
()->
bFaed
) ) {

155 
mp1
[
i
]->
	`nodeLoİ
();

156 #ifdeà
DEBUGLOG


157 ifĞ(
i
 =ğ0è&& (
·r
->
glob®time
 % 500 == 0) ) {

158 
log
->
	`LOG
(&
mp1
[
i
]->
	`g‘Memb”Node
()->
addr
, "@@time=%d", 
·r
->
	`g‘cu¼time
());

164 
	}
}

173 
	gAµliÿtiÚ
::
	$ç
() {

174 
i
, 
»moved
;

177 ifĞ
·r
->
DROP_MSG
 &&…¬->
	`g‘cu¼time
() == 50 ) {

178 
·r
->
drİmsg
 = 1;

181 ifĞ
·r
->
SINGLE_FAILURE
 &&…¬->
	`g‘cu¼time
() == 100 ) {

182 
»moved
 = (
	`¿nd
(è% 
·r
->
EN_GPSZ
);

183 #ifdeà
DEBUGLOG


184 
log
->
	`LOG
(&
mp1
[
»moved
]->
	`g‘Memb”Node
()->
addr
, "Nodçed‡ˆtime=%d", 
·r
->
	`g‘cu¼time
());

186 
mp1
[
»moved
]->
	`g‘Memb”Node
()->
bFaed
 = 
Œue
;

188 ifĞ
·r
->
	`g‘cu¼time
() == 100 ) {

189 
»moved
 = 
	`¿nd
(è% 
·r
->
EN_GPSZ
/2;

190  
i
 = 
»moved
; i <„emoved + 
·r
->
EN_GPSZ
/2; i++ ) {

191 #ifdeà
DEBUGLOG


192 
log
->
	`LOG
(&
mp1
[
i
]->
	`g‘Memb”Node
()->
addr
, "Nodçed‡ˆtimğ%d", 
·r
->
	`g‘cu¼time
());

194 
mp1
[
i
]->
	`g‘Memb”Node
()->
bFaed
 = 
Œue
;

198 ifĞ
·r
->
DROP_MSG
 &&…¬->
	`g‘cu¼time
() == 300) {

199 
·r
->
drİmsg
=0;

202 
	}
}

209 
Add»ss
 
	gAµliÿtiÚ
::
	$g‘jošaddr
(){

211 
Add»ss
 
jošaddr
;

212 
jošaddr
.
	`š™
();

213 *(*)(&(
jošaddr
.
addr
))=1;

214 *(*)(&(
jošaddr
.
addr
[4]))=0;

216  
jošaddr
;

217 
	}
}

	@Application.h

7 #iâdeà
_APPLICATION_H_


8 
	#_APPLICATION_H_


	)

10 
	~"¡dšşudes.h
"

11 
	~"MP1Node.h
"

12 
	~"Log.h
"

13 
	~"P¬ams.h
"

14 
	~"Memb”.h
"

15 
	~"EmulN‘.h
"

16 
	~"Queue.h
"

21 
	gnodeCouÁ
 = 0;

26 
	#ARGS_COUNT
 2

	)

27 
	#TOTAL_RUNNING_TIME
 700

	)

34 şas 
	cAµliÿtiÚ
{

35 
	m´iv©e
:

38 
JOINADDR
[30];

39 
EmulN‘
 *
	m’
;

40 
Log
 *
	mlog
;

41 
MP1Node
 **
	mmp1
;

42 
P¬ams
 *
	m·r
;

43 
	mpublic
:

44 
AµliÿtiÚ
(*);

45 
	mvœtu®
 ~
AµliÿtiÚ
();

46 
Add»ss
 
g‘jošaddr
();

47 
run
();

48 
mp1Run
();

49 
ç
();

	@EmulNet.cpp

7 
	~"EmulN‘.h
"

12 
	gEmulN‘
::
	$EmulN‘
(
P¬ams
 *
p
)

15 
i
,
j
;

16 
·r
 = 
p
;

17 
emuÊ‘
.
	`£tNextId
(1);

18 
emuÊ‘
.
	`£‰Cu¼BuffSize
(0);

19 
’In™ed
=0;

20  
i
 = 0; i < 
MAX_NODES
; i++ ) {

21  
j
 = 0; j < 
MAX_TIME
; j++ ) {

22 
£Á_msgs
[
i
][
j
] = 0;

23 
»cv_msgs
[
i
][
j
] = 0;

27 
	}
}

32 
	gEmulN‘
::
	$EmulN‘
(
EmulN‘
 &
ªÙh”EmulN‘
) {

33 
i
, 
j
;

34 
this
->
·r
 = 
ªÙh”EmulN‘
.par;

35 
this
->
’In™ed
 = 
ªÙh”EmulN‘
.enInited;

36  
i
 = 0; i < 
MAX_NODES
; i++ ) {

37  
j
 = 0; j < 
MAX_TIME
; j++ ) {

38 
this
->
£Á_msgs
[
i
][
j
] = 
ªÙh”EmulN‘
.sent_msgs[i][j];

39 
this
->
»cv_msgs
[
i
][
j
] = 
ªÙh”EmulN‘
.recv_msgs[i][j];

42 
this
->
emuÊ‘
 = 
ªÙh”EmulN‘
.emulnet;

43 
	}
}

48 
	gEmulN‘
& EmulN‘::
İ”©Ü
 =(
EmulN‘
 &
ªÙh”EmulN‘
) {

49 
i
, 
j
;

50 
	gthis
->
	g·r
 = 
ªÙh”EmulN‘
.
·r
;

51 
	gthis
->
	g’In™ed
 = 
ªÙh”EmulN‘
.
’In™ed
;

52  
	gi
 = 0; i < 
	gMAX_NODES
; i++ ) {

53  
	gj
 = 0; j < 
	gMAX_TIME
; j++ ) {

54 
	gthis
->
	g£Á_msgs
[
i
][
j
] = 
ªÙh”EmulN‘
.
£Á_msgs
[i][j];

55 
	gthis
->
	g»cv_msgs
[
i
][
j
] = 
ªÙh”EmulN‘
.
»cv_msgs
[i][j];

58 
	gthis
->
	gemuÊ‘
 = 
ªÙh”EmulN‘
.
emuÊ‘
;

59  *
	gthis
;

65 
	gEmulN‘
::~
	$EmulN‘
(è{
	}
}

72 *
EmulN‘
::
	$ENš™
(
Add»ss
 *
myaddr
, 
pÜt
) {

74 *(*)(
myaddr
->
addr
èğ
emuÊ‘
.
Ãxtid
++;

75 *(*)(&
myaddr
->
addr
[4]) = 0;

76  
myaddr
;

77 
	}
}

87 
	gEmulN‘
::
	$EN£nd
(
Add»ss
 *
myaddr
, Add»s *
tßddr
, *
d©a
, 
size
) {

88 
’_msg
 *
em
;

89 
‹mp
[2048];

90 
£ndmsg
 = 
	`¿nd
() % 100;

92 ifĞ(
emuÊ‘
.
cu¼buffsize
 >ğ
ENBUFFSIZE
è|| (
size
 + ()(
’_msg
è>ğ
·r
->
MAX_MSG_SIZE
è|| (·r->
drİmsg
 && 
£ndmsg
 < (èÕ¬->
MSG_DROP_PROB
 * 100)) ) {

96 
em
 = (
’_msg
 *)
	`m®loc
(Ón_msgè+ 
size
);

97 
em
->
size
 = size;

99 
	`memıy
(&(
em
->
äom
.
addr
), &(
myaddr
->addr), (em->from.addr));

100 
	`memıy
(&(
em
->
to
.
addr
), &(
tßddr
->addr), Óm->
äom
.addr));

101 
	`memıy
(
em
 + 1, 
d©a
, 
size
);

103 
emuÊ‘
.
buff
[emuÊ‘.
cu¼buffsize
++] = 
em
;

105 
¤c
 = *(*)(
myaddr
->
addr
);

106 
time
 = 
·r
->
	`g‘cu¼time
();

108 
	`as£¹
(
¤c
 <ğ
MAX_NODES
);

109 
	`as£¹
(
time
 < 
MAX_TIME
);

111 
£Á_msgs
[
¤c
][
time
]++;

113 #ifdeà
DEBUGLOG


114 
	`¥rštf
(
‹mp
, "S’dšg 4+%d B msgy³ %dØ%d.%d.%d.%d:%d ", 
size
-4, *(*)
d©a
, 
tßddr
->
addr
[0],oaddr->addr[1],oaddr->addr[2],oaddr->addr[3], *(*)&toaddr->addr[4]);

117  
size
;

118 
	}
}

128 
	gEmulN‘
::
	$EN£nd
(
Add»ss
 *
myaddr
, Add»s *
tßddr
, 
¡ršg
 
d©a
) {

129 * 
¡r
 = (*è
	`m®loc
(
d©a
.
	`Ëngth
() * ());

130 
	`memıy
(
¡r
, 
d©a
.
	`c_¡r
(), d©a.
	`size
());

131 
»t
 = 
this
->
	`EN£nd
(
myaddr
, 
tßddr
, 
¡r
, (
d©a
.
	`Ëngth
() * ()));

132 
	`ä“
(
¡r
);

133  
»t
;

134 
	}
}

144 
	gEmulN‘
::
EN»cv
(
Add»ss
 *
myaddr
, (* 
’q
)(*, *, ), 
timev®
 *
t
, 
times
, *
queue
){

146 
i
;

147 * 
tmp
;

148 
sz
;

149 
’_msg
 *
emsg
;

151  
i
 = 
emuÊ‘
.
cu¼buffsize
 - 1; i >= 0; i-- ) {

152 
emsg
 = 
emuÊ‘
.
buff
[
i
];

154 iàĞ0 =ğ
	`¡rcmp
(
emsg
->
to
.
addr
, 
myaddr
->addr) ) {

155 
sz
 = 
emsg
->
size
;

156 
tmp
 = (*è
	`m®loc
(
sz
 * ());

157 
	`memıy
(
tmp
, (*)(
emsg
+1), 
sz
);

159 
emuÊ‘
.
buff
[
i
] =ƒmuÊ‘.buff[emuÊ‘.
cu¼buffsize
-1];

160 
emuÊ‘
.
cu¼buffsize
--;

162 (*
’q
)(
queue
, (*)
tmp
, 
sz
);

164 
	`ä“
(
emsg
);

166 
d¡
 = *(*)(
myaddr
->
addr
);

167 
time
 = 
·r
->
	`g‘cu¼time
();

169 
	`as£¹
(
d¡
 <ğ
MAX_NODES
);

170 
	`as£¹
(
time
 < 
MAX_TIME
);

172 
»cv_msgs
[
d¡
][
time
]++;

177 
	}
}

184 
	gEmulN‘
::
	$ENş—nup
() {

185 
emuÊ‘
.
Ãxtid
=0;

186 
i
, 
j
;

187 
£Á_tÙ®
, 
»cv_tÙ®
;

189 
FILE
* 
fe
 = 
	`fİ’
("msgcount.log", "w+");

191 
emuÊ‘
.
cu¼buffsize
 > 0) {

192 
	`ä“
(
emuÊ‘
.
buff
[--emuÊ‘.
cu¼buffsize
]);

195  
i
 = 1; i <ğ
·r
->
EN_GPSZ
; i++ ) {

196 
	`årštf
(
fe
, "nod%3d ", 
i
);

197 
£Á_tÙ®
 = 0;

198 
»cv_tÙ®
 = 0;

200 
j
 = 0; j < 
·r
->
	`g‘cu¼time
(); j++) {

202 
£Á_tÙ®
 +ğ
£Á_msgs
[
i
][
j
];

203 
»cv_tÙ®
 +ğ
»cv_msgs
[
i
][
j
];

204 ià(
i
 != 67) {

205 
	`årštf
(
fe
, " (%4d, %4d)", 
£Á_msgs
[
i
][
j
], 
»cv_msgs
[i][j]);

206 ià(
j
 % 10 == 9) {

207 
	`årštf
(
fe
, "\n ");

211 
	`årštf
(
fe
, "¥ecŸÈ%4d %4d %4d\n", 
j
, 
£Á_msgs
[
i
][j], 
»cv_msgs
[i][j]);

214 
	`årštf
(
fe
, "\n");

215 
	`årštf
(
fe
, "nod%3d s’t_tÙ® %6u„ecv_tÙ® %6u\n\n", 
i
, 
£Á_tÙ®
, 
»cv_tÙ®
);

218 
	`fşo£
(
fe
);

220 
	}
}

	@EmulNet.h

7 #iâdeà
_EMULNET_H_


8 
	#_EMULNET_H_


	)

10 
	#MAX_NODES
 1000

	)

11 
	#MAX_TIME
 3600

	)

12 
	#ENBUFFSIZE
 30000

	)

14 
	~"¡dšşudes.h
"

15 
	~"P¬ams.h
"

16 
	~"Memb”.h
"

18 
usšg
 
Çme¥aû
 
	g¡d
;

23 
	s’_msg
 {

25 
	msize
;

27 
Add»ss
 
	mäom
;

29 
Add»ss
 
	mto
;

30 }
	t’_msg
;

35 şas 
	cEM
 {

36 
	mpublic
:

37 
Ãxtid
;

38 
	mcu¼buffsize
;

39 
	mfœ¡–tšdex
;

40 
’_msg
* 
	mbuff
[
ENBUFFSIZE
];

41 
	$EM
() {}

42 
EM
& 
İ”©Ü
 = (EM &
ªÙh”EM
) {

43 
this
->
Ãxtid
 = 
ªÙh”EM
.
	`g‘NextId
();

44 
this
->
cu¼buffsize
 = 
ªÙh”EM
.
	`g‘Cu¼BuffSize
();

45 
this
->
fœ¡–tšdex
 = 
ªÙh”EM
.
	`g‘Fœ¡EÉIndex
();

46 
i
 = 
this
->
cu¼buffsize
;

47 
i
 > 0) {

48 
this
->
buff
[
i
] = 
ªÙh”EM
.buff[i];

49 
i
--;

51  *
this
;

52 
	}
}

53 
	$g‘NextId
() {

54  
Ãxtid
;

55 
	}
}

56 
	$g‘Cu¼BuffSize
() {

57  
cu¼buffsize
;

58 
	}
}

59 
	$g‘Fœ¡EÉIndex
() {

60  
fœ¡–tšdex
;

61 
	}
}

62 
	$£tNextId
(
Ãxtid
) {

63 
this
->
Ãxtid
 =‚extid;

64 
	}
}

65 
	$£‰Cu¼BuffSize
(
cu¼buffsize
) {

66 
this
->
cu¼buffsize
 = currbuffsize;

67 
	}
}

68 
	$£tFœ¡EÉIndex
(
fœ¡–tšdex
) {

69 
this
->
fœ¡–tšdex
 = firsteltindex;

70 
	}
}

71 
	gvœtu®
 ~
	$EM
(è{
	}
}

79 şas 
	cEmulN‘


81 
	m´iv©e
:

82 
P¬ams
* 
·r
;

83 
	m£Á_msgs
[
MAX_NODES
 + 1][
MAX_TIME
];

84 
	m»cv_msgs
[
MAX_NODES
 + 1][
MAX_TIME
];

85 
	m’In™ed
;

86 
EM
 
	memuÊ‘
;

87 
	mpublic
:

88 
EmulN‘
(
P¬ams
 *
p
);

89 
EmulN‘
(EmulN‘ &
ªÙh”EmulN‘
);

90 
	mEmulN‘
& 
	mİ”©Ü
 = (
EmulN‘
 &
ªÙh”EmulN‘
);

91 
	mvœtu®
 ~
EmulN‘
();

92 *
ENš™
(
Add»ss
 *
myaddr
, 
pÜt
);

93 
EN£nd
(
Add»ss
 *
myaddr
, Add»s *
tßddr
, 
¡ršg
 
d©a
);

94 
EN£nd
(
Add»ss
 *
myaddr
, Add»s *
tßddr
, *
d©a
, 
size
);

95 
EN»cv
(
Add»ss
 *
myaddr
, (* 
’q
)(*, *, ), 
timev®
 *
t
, 
times
, *
queue
);

96 
	`ENş—nup
();

	@Log.cpp

7 
	~"Log.h
"

12 
	gLog
::
	$Log
(
P¬ams
 *
p
) {

13 
·r
 = 
p
;

14 
fœ¡Time
 = 
çl£
;

15 
	}
}

20 
	gLog
::
	$Log
(cÚ¡ 
Log
 &
ªÙh”Log
) {

21 
this
->
·r
 = 
ªÙh”Log
.par;

22 
this
->
fœ¡Time
 = 
ªÙh”Log
.firstTime;

23 
	}
}

28 
	gLog
& Log::
İ”©Ü
 = (cÚ¡ 
Log
& 
ªÙh”Log
) {

29 
this
->
·r
 = 
ªÙh”Log
.par;

30 
	gthis
->
	gfœ¡Time
 = 
ªÙh”Log
.
fœ¡Time
;

31  *
	gthis
;

37 
	gLog
::~
	$Log
(è{
	}
}

44 
Log
::
	$LOG
(
Add»ss
 *
addr
, cÚ¡ * 
¡r
, ...) {

46 
FILE
 *
å
;

47 
FILE
 *
å2
;

48 
va_li¡
 
v¬¬gli¡
;

49 
bufãr
[30000];

50 
numwr™es
;

51 
¡d¡ršg
[30];

52 
¡d¡ršg2
[40];

53 
¡d¡ršg3
[40];

54 
dbg_İ’ed
=0;

56 if(
dbg_İ’ed
 != 639){

57 
numwr™es
=0;

59 
¡d¡ršg2
[0]=0;

61 
	`¡rıy
(
¡d¡ršg3
, 
¡d¡ršg2
);

63 
	`¡rÿt
(
¡d¡ršg2
, 
DBG_LOG
);

64 
	`¡rÿt
(
¡d¡ršg3
, 
STATS_LOG
);

66 
å
 = 
	`fİ’
(
¡d¡ršg2
, "w");

67 
å2
 = 
	`fİ’
(
¡d¡ršg3
, "w");

69 
dbg_İ’ed
=639;

73 
	`¥rštf
(
¡d¡ršg
, "%d.%d.%d.%d:%d ", 
addr
->addr[0],‡ddr->addr[1],‡ddr->addr[2],‡ddr->addr[3], *(*)&addr->addr[4]);

75 
	`va_¡¬t
(
v¬¬gli¡
, 
¡r
);

76 
	`v¥rštf
(
bufãr
, 
¡r
, 
v¬¬gli¡
);

77 
	`va_’d
(
v¬¬gli¡
);

79 ià(!
fœ¡Time
) {

80 
magicNumb”
 = 0;

81 
¡ršg
 
magic
 = 
MAGIC_NUMBER
;

82 
Ën
 = 
magic
.
	`Ëngth
();

83  
i
 = 0; i < 
Ën
; i++ ) {

84 
magicNumb”
 +ğ()
magic
.
	`©
(
i
);

86 
	`årštf
(
å
, "%x\n", 
magicNumb”
);

87 
fœ¡Time
 = 
Œue
;

90 if(
	`memcmp
(
bufãr
, "#STATSLOG#", 10)==0){

91 
	`årštf
(
å2
, "\À%s", 
¡d¡ršg
);

92 
	`årštf
(
å2
, "[%d] ", 
·r
->
	`g‘cu¼time
());

94 
	`årštf
(
å2
, 
bufãr
);

97 
	`årštf
(
å
, "\À%s", 
¡d¡ršg
);

98 
	`årštf
(
å
, "[%d] ", 
·r
->
	`g‘cu¼time
());

99 
	`årštf
(
å
, 
bufãr
);

103 if(++
numwr™es
 >ğ
MAXWRITES
){

104 
	`fæush
(
å
);

105 
	`fæush
(
å2
);

106 
numwr™es
=0;

109 
	}
}

116 
	gLog
::
	$logNodeAdd
(
Add»ss
 *
thisNode
, Add»s *
addedAddr
) {

117 
¡d¡ršg
[100];

118 
	`¥rštf
(
¡d¡ršg
, "Nod%d.%d.%d.%d:%d jošed‡ˆtim%d", 
addedAddr
->
addr
[0],‡ddedAddr->addr[1],‡ddedAddr->addr[2],‡ddedAddr->addr[3], *(*)&addedAddr->addr[4], 
·r
->
	`g‘cu¼time
());

119 
	`LOG
(
thisNode
, 
¡d¡ršg
);

120 
	}
}

127 
	gLog
::
	$logNodeRemove
(
Add»ss
 *
thisNode
, Add»s *
»movedAddr
) {

128 
¡d¡ršg
[30];

129 
	`¥rštf
(
¡d¡ršg
, "Nod%d.%d.%d.%d:%d„emoved‡ˆtim%d", 
»movedAddr
->
addr
[0],„emovedAddr->addr[1],„emovedAddr->addr[2],„emovedAddr->addr[3], *(*)&»movedAddr->addr[4], 
·r
->
	`g‘cu¼time
());

130 
	`LOG
(
thisNode
, 
¡d¡ršg
);

131 
	}
}

	@Log.h

7 #iâdeà
_LOG_H_


8 
	#_LOG_H_


	)

10 
	~"¡dšşudes.h
"

11 
	~"P¬ams.h
"

12 
	~"Memb”.h
"

18 
	#MAXWRITES
 1

	)

19 
	#MAGIC_NUMBER
 "CS425"

	)

20 
	#DBG_LOG
 "dbg.log"

	)

21 
	#STATS_LOG
 "¡©s.log"

	)

28 şas 
	cLog
{

29 
	m´iv©e
:

30 
P¬ams
 *
·r
;

31 
boŞ
 
	mfœ¡Time
;

32 
	mpublic
:

33 
Log
(
P¬ams
 *
p
);

34 
Log
(cÚ¡ Log &
ªÙh”Log
);

35 
	mLog
& 
	mİ”©Ü
 = (cÚ¡ 
Log
 &
ªÙh”Log
);

36 
	mvœtu®
 ~
Log
();

37 
LOG
(
Add»ss
 *, cÚ¡ * 
¡r
, ...);

38 
logNodeAdd
(
Add»ss
 *, Address *);

39 
logNodeRemove
(
Add»ss
 *, Address *);

	@MP1Node.cpp

8 
	~"MP1Node.h
"

19 
	gMP1Node
::
	$MP1Node
(
Memb”
 *
memb”
, 
P¬ams
 *
·¿ms
, 
EmulN‘
 *
emul
, 
Log
 *
log
, 
Add»ss
 *
add»ss
) {

20  
i
 = 0; i < 6; i++ ) {

21 
NULLADDR
[
i
] = 0;

23 
this
->
memb”Node
 = 
memb”
;

24 
this
->
emulN‘
 = 
emul
;

25 
this
->
log
 =†og;

26 
this
->
·r
 = 
·¿ms
;

27 
this
->
memb”Node
->
addr
 = *
add»ss
;

28 
	}
}

33 
	gMP1Node
::~
	$MP1Node
(è{
	}
}

41 
MP1Node
::
	$»cvLoİ
() {

42 iàĞ
memb”Node
->
bFaed
 ) {

43  
çl£
;

46  
emulN‘
->
	`EN»cv
(&(
memb”Node
->
addr
), 
’queueW¿µ”
, 
NULL
, 1, &(memb”Node->
mp1q
));

48 
	}
}

55 
	gMP1Node
::
	$’queueW¿µ”
(*
’v
, *
buff
, 
size
) {

56 
Queue
 
q
;

57  
q
.
	`’queue
((
queue
<
q_–t
> *)
’v
, (*)
buff
, 
size
);

58 
	}
}

67 
	gMP1Node
::
	$nodeS¹
(*
£rvaddr¡r
, 
£rvpÜt
) {

68 
Add»ss
 
jošaddr
;

69 
jošaddr
 = 
	`g‘JošAdd»ss
();

72 ifĞ
	`š™ThisNode
(&
jošaddr
) == -1 ) {

73 #ifdeà
DEBUGLOG


74 
log
->
	`LOG
(&
memb”Node
->
addr
, "init_thisnode failed. Exit.");

76 
	`ex™
(1);

79 ifĞ!
	`šŒoduûS–fToGroup
(&
jošaddr
) ) {

80 
	`fšishUpThisNode
();

81 #ifdeà
DEBUGLOG


82 
log
->
	`LOG
(&
memb”Node
->
addr
, "Unableo join selfo group. Exiting.");

84 
	`ex™
(1);

88 
	}
}

95 
	gMP1Node
::
	$š™ThisNode
(
Add»ss
 *
jošaddr
) {

102 
memb”Node
->
bFaed
 = 
çl£
;

103 
memb”Node
->
š™ed
 = 
Œue
;

104 
memb”Node
->
šGroup
 = 
çl£
;

106 
memb”Node
->
Âb
 = 0;

107 
memb”Node
->
h—¹b—t
 = 0;

108 
memb”Node
->
pšgCouÁ”
 = 
TFAIL
;

109 
memb”Node
->
timeOutCouÁ”
 = -1;

110 
	`š™Memb”Li¡TabË
(
memb”Node
);

113 
	}
}

120 
	gMP1Node
::
	$šŒoduûS–fToGroup
(
Add»ss
 *
jošaddr
) {

121 
Mes§geHdr
 *
msg
;

122 #ifdeà
DEBUGLOG


123 
s
[1024];

126 iàĞ0 =ğ
	`memcmp
((*)&(
memb”Node
->
addr
.addr), (*)&(
jošaddr
->addr), (memberNode->addr.addr))) {

128 #ifdeà
DEBUGLOG


129 
log
->
	`LOG
(&
memb”Node
->
addr
, "Starting up group...");

131 
memb”Node
->
šGroup
 = 
Œue
;

134 
size_t
 
msgsize
 = (
Mes§geHdr
è+ (
jošaddr
->
addr
) + () + 1;

135 
msg
 = (
Mes§geHdr
 *è
	`m®loc
(
msgsize
 * ());

138 
msg
->
msgTy³
 = 
JOINREQ
;

139 
	`memıy
((*)(
msg
+1), &
memb”Node
->
addr
.addr, (memberNode->addr.addr));

140 
	`memıy
((*)(
msg
+1è+ 1 + (
memb”Node
->
addr
.addr), &memb”Node->
h—¹b—t
, ());

142 #ifdeà
DEBUGLOG


143 
	`¥rštf
(
s
, "Tryingo join...");

144 
log
->
	`LOG
(&
memb”Node
->
addr
, 
s
);

148 
emulN‘
->
	`EN£nd
(&
memb”Node
->
addr
, 
jošaddr
, (*)
msg
, 
msgsize
);

150 
	`ä“
(
msg
);

155 
	}
}

162 
	gMP1Node
::
	$fšishUpThisNode
(){

166 
memb”Node
->
bFaed
 = 
Œue
;

167 
memb”Node
->
š™ed
 = 
çl£
;

168 
memb”Node
->
šGroup
 = 
çl£
;

170 
memb”Node
->
Âb
 = -1;

171 
memb”Node
->
h—¹b—t
 = -1;

172 
memb”Node
->
pšgCouÁ”
 = 
TFAIL
;

173 
memb”Node
->
timeOutCouÁ”
 = -1;

176 
	}
}

184 
	gMP1Node
::
	$nodeLoİ
() {

185 ià(
memb”Node
->
bFaed
) {

190 
	`checkMes§ges
();

193 ifĞ!
memb”Node
->
šGroup
 ) {

198 
	`nodeLoİOps
();

201 
	}
}

208 
	gMP1Node
::
	$checkMes§ges
() {

209 *
±r
;

210 
size
;

213  !
memb”Node
->
mp1q
.
	`em±y
() ) {

214 
±r
 = 
memb”Node
->
mp1q
.
	`äÚt
().
–t
;

215 
size
 = 
memb”Node
->
mp1q
.
	`äÚt
().size;

216 
memb”Node
->
mp1q
.
	`pİ
();

217 
	`»cvC®lBack
((*)
memb”Node
, (*)
±r
, 
size
);

220 
	}
}

227 
boŞ
 
	gMP1Node
::
	$»cvC®lBack
(*
’v
, *
d©a
, 
size
 ) {

231 
Memb”
 *
memb”
 = (Memb” *)
’v
;

232 
Mes§geHdr
 *
msg
 = (Mes§geHd¸*)
d©a
;

233 
Mes§geHdr
 *
s_msg
;

234 
Add»ss
 *
addr
;

235 
id
;

236 
pÜt
;

237 
hb
;

238 #ifdeà
DEBUGLOG


239 
s
[1024];

240 
	`¥rštf
(
s
, "Recieved Call Back...");

241 
log
->
	`LOG
(&
memb”Node
->
addr
, 
s
);

243 
	`´štf
("---------------------------------------------------------------------\n");

245 
	`´štf
("Address of MemberNode :");

246 
	`´štAdd»ss
(&(
memb”
->
addr
));

248 
addr
 = (
Add»ss
 *è(
msg
 + 1);

249 
	`´štAdd»ss
(
addr
);

251 
id
 = *(*è(&
addr
->addr);

252 
	`´štf
("Add»s <id> : %d \n", 
id
);

254 
pÜt
 = *(*è(&
addr
->addr[4]);

255 
	`´štf
("Add»s <PÜt> : %hi\n", 
pÜt
);

257 
hb
 = * (*è(
addr
 + 1) ;

258 
	`´štf
("H—rB—ˆ: %ld \n", 
hb
);

260 
msg
->
msgTy³
) {

261 
JOINREQ
 :

263 
	`´štf
("Message Type : JOINREQ \n");

264 
size_t
 
msgsize
 = (
Mes§geHdr
è+ (
Add»ss
) + () + 1;

265 
s_msg
 = (
Mes§geHdr
 *è
	`m®loc
(
msgsize
 * ());

268 
s_msg
->
msgTy³
 = 
JOINREP
;

269 
	`memıy
((*)(
s_msg
+1), &
memb”Node
->
addr
.addr, (memberNode->addr.addr));

270 
	`memıy
((*)(
s_msg
+1è+ 1 + (
memb”Node
->
addr
.addr), &memb”Node->
h—¹b—t
, ());

273 
emulN‘
->
	`EN£nd
(&
memb”Node
->
addr
,‡ddr, (*)
s_msg
, 
msgsize
);

275 
	`ä“
(
msg
);

277 #ifdeà
DEBUGLOG


278 
	`¥rštf
(
s
, "Reûived JOINREQ Mes§gäom id : %d", 
id
);

279 
log
->
	`LOG
(&
memb”Node
->
addr
, 
s
);

283 
JOINREP
 :

285 
	`´štf
("Message Type : JOINREP \n");

286 
memb”Node
->
šGroup
 = 
Œue
;

288 #ifdeà
DEBUGLOG


289 
	`¥rštf
(
s
, "Reûived JOINREP Mes§gäom id : %d", 
id
);

290 
log
->
	`LOG
(&
memb”Node
->
addr
, 
s
);

291 
	`¥rštf
(
s
, "Jošedhgrou°%d", 
id
);

292 
log
->
	`LOG
(&
memb”Node
->
addr
, 
s
);

297 
	`´štf
 ("Unknown message ");

299 
	`´štf
("---------------------------------------------------------------------\n");

301  
Œue
;;

302 
	}
}

311 
	gMP1Node
::
	$nodeLoİOps
() {

318 
	}
}

325 
	gMP1Node
::
	$isNuÎAdd»ss
(
Add»ss
 *
addr
) {

326  (
	`memcmp
(
addr
->addr, 
NULLADDR
, 6) == 0 ? 1 : 0);

327 
	}
}

334 
Add»ss
 
	gMP1Node
::
	$g‘JošAdd»ss
() {

335 
Add»ss
 
jošaddr
;

337 
	`mem£t
(&
jošaddr
, 0, (
Add»ss
));

338 *(*)(&
jošaddr
.
addr
) = 1;

339 *(*)(&
jošaddr
.
addr
[4]) = 0;

341  
jošaddr
;

342 
	}
}

349 
	gMP1Node
::
	$š™Memb”Li¡TabË
(
Memb”
 *
memb”Node
) {

350 
memb”Node
->
memb”Li¡
.
	`ş—r
();

351 
	}
}

358 
	gMP1Node
::
	$´štAdd»ss
(
Add»ss
 *
addr
)

360 
	`´štf
("%d.%d.%d.%d:%d \n", 
addr
->addr[0],addr->addr[1],addr->addr[2],

361 
addr
->addr[3], *(*)&addr->addr[4]) ;

362 
	}
}

	@MP1Node.h

8 #iâdeà
_MP1NODE_H_


9 
	#_MP1NODE_H_


	)

11 
	~"¡dšşudes.h
"

12 
	~"Log.h
"

13 
	~"P¬ams.h
"

14 
	~"Memb”.h
"

15 
	~"EmulN‘.h
"

16 
	~"Queue.h
"

21 
	#TREMOVE
 20

	)

22 
	#TFAIL
 5

	)

31 
	eMsgTy³s
{

32 
	mJOINREQ
,

33 
	mJOINREP
,

34 
	mDUMMYLASTMSGTYPE


42 
	sMes§geHdr
 {

43 
MsgTy³s
 
	mmsgTy³
;

44 }
	tMes§geHdr
;

51 şas 
	cMP1Node
 {

52 
	m´iv©e
:

53 
EmulN‘
 *
emulN‘
;

54 
Log
 *
	mlog
;

55 
P¬ams
 *
	m·r
;

56 
Memb”
 *
	mmemb”Node
;

57 
	mNULLADDR
[6];

59 
	mpublic
:

60 
MP1Node
(
Memb”
 *, 
P¬ams
 *, 
EmulN‘
 *, 
Log
 *, 
Add»ss
 *);

61 
Memb”
 * 
	$g‘Memb”Node
() {

62  
memb”Node
;

64 
	`»cvLoİ
();

65 
	`’queueW¿µ”
(*
’v
, *
buff
, 
size
);

66 
	`nodeS¹
(*
£rvaddr¡r
, 
£rv”pÜt
);

67 
	`š™ThisNode
(
Add»ss
 *
jošaddr
);

68 
	`šŒoduûS–fToGroup
(
Add»ss
 *
jošAdd»ss
);

69 
	`fšishUpThisNode
();

70 
	`nodeLoİ
();

71 
	`checkMes§ges
();

72 
boŞ
 
	`»cvC®lBack
(*
’v
, *
d©a
, 
size
);

73 
	`nodeLoİOps
();

74 
	`isNuÎAdd»ss
(
Add»ss
 *
addr
);

75 
Add»ss
 
	`g‘JošAdd»ss
();

76 
	`š™Memb”Li¡TabË
(
Memb”
 *
memb”Node
);

77 
	`´štAdd»ss
(
Add»ss
 *
addr
);

78 
vœtu®
 ~
	`MP1Node
();

79 
	}
};

	@Member.cpp

7 
	~"Memb”.h
"

12 
	gq_–t
::
	$q_–t
(*
–t
, 
size
): 
	`–t
ÓÉ), 
	$size
(
size
è{
	}
}

17 
	gAdd»ss
::
	$Add»ss
(cÚ¡ 
Add»ss
 &
ªÙh”Add»ss
) {

19 
	`memıy
(&
addr
, &
ªÙh”Add»ss
.addr, (addr));

20 
	}
}

25 
	gAdd»ss
& Add»ss::
İ”©Ü
 =(cÚ¡ 
Add»ss
& 
ªÙh”Add»ss
) {

27 
memıy
(&
addr
, &
ªÙh”Add»ss
.addr, (addr));

28  *
	gthis
;

36 
boŞ
 
	gAdd»ss
::
İ”©Ü
 ==(cÚ¡ 
Add»ss
& 
ªÙh”Add»ss
) {

37  !
memcmp
(
this
->
addr
, 
ªÙh”Add»ss
.addr, (this->addr));

43 
	gMemb”Li¡EÁry
::
	$Memb”Li¡EÁry
(
id
, 
pÜt
, 
h—¹b—t
, 
time¡amp
): 
	`id
(id), 
	`pÜt
ÕÜt), 
	`h—¹b—t
(h—¹b—t), 
	$time¡amp
(
time¡amp
è{
	}
}

48 
	gMemb”Li¡EÁry
::
	$Memb”Li¡EÁry
(
id
, 
pÜt
): 
	`id
(id), 
	$pÜt
(
pÜt
è{
	}
}

53 
	gMemb”Li¡EÁry
::
	$Memb”Li¡EÁry
(cÚ¡ 
Memb”Li¡EÁry
 &
ªÙh”MLE
) {

54 
this
->
h—¹b—t
 = 
ªÙh”MLE
.heartbeat;

55 
this
->
id
 = 
ªÙh”MLE
.id;

56 
this
->
pÜt
 = 
ªÙh”MLE
.port;

57 
this
->
time¡amp
 = 
ªÙh”MLE
.timestamp;

58 
	}
}

63 
	gMemb”Li¡EÁry
& Memb”Li¡EÁry::
İ”©Ü
 =(cÚ¡ 
Memb”Li¡EÁry
 &
ªÙh”MLE
) {

64 
Memb”Li¡EÁry
 
‹mp
(
ªÙh”MLE
);

65 
sw­
(
h—¹b—t
, 
‹mp
.heartbeat);

66 
sw­
(
id
, 
‹mp
.id);

67 
sw­
(
pÜt
, 
‹mp
.port);

68 
sw­
(
time¡amp
, 
‹mp
.timestamp);

69  *
	gthis
;

77 
	gMemb”Li¡EÁry
::
	$g‘id
() {

78  
id
;

79 
	}
}

86 
	gMemb”Li¡EÁry
::
	$g‘pÜt
() {

87  
pÜt
;

88 
	}
}

95 
	gMemb”Li¡EÁry
::
	$g‘h—¹b—t
() {

96  
h—¹b—t
;

97 
	}
}

104 
	gMemb”Li¡EÁry
::
	$g‘time¡amp
() {

105  
time¡amp
;

106 
	}
}

113 
	gMemb”Li¡EÁry
::
	$£tid
(
id
) {

114 
this
->
id
 = id;

115 
	}
}

122 
	gMemb”Li¡EÁry
::
	$£Üt
(
pÜt
) {

123 
this
->
pÜt
 =…ort;

124 
	}
}

131 
	gMemb”Li¡EÁry
::
	$£th—¹b—t
(
h—rb—t
) {

132 
this
->
h—¹b—t
 = 
h—rb—t
;

133 
	}
}

140 
	gMemb”Li¡EÁry
::
	$£‰ime¡amp
(
time¡amp
) {

141 
this
->
time¡amp
 =imestamp;

142 
	}
}

147 
	gMemb”
::
	$Memb”
(cÚ¡ 
Memb”
 &
ªÙh”Memb”
) {

148 
this
->
addr
 = 
ªÙh”Memb”
.addr;

149 
this
->
š™ed
 = 
ªÙh”Memb”
.inited;

150 
this
->
šGroup
 = 
ªÙh”Memb”
.inGroup;

151 
this
->
bFaed
 = 
ªÙh”Memb”
.bFailed;

152 
this
->
Âb
 = 
ªÙh”Memb”
.nnb;

153 
this
->
h—¹b—t
 = 
ªÙh”Memb”
.heartbeat;

154 
this
->
pšgCouÁ”
 = 
ªÙh”Memb”
.pingCounter;

155 
this
->
timeOutCouÁ”
 = 
ªÙh”Memb”
.timeOutCounter;

156 
this
->
memb”Li¡
 = 
ªÙh”Memb”
.memberList;

157 
this
->
myPos
 = 
ªÙh”Memb”
.myPos;

158 
this
->
mp1q
 = 
ªÙh”Memb”
.mp1q;

159 
	}
}

164 
	gMemb”
& Memb”::
İ”©Ü
 =(cÚ¡ 
Memb”
& 
ªÙh”Memb”
) {

165 
this
->
addr
 = 
ªÙh”Memb”
.addr;

166 
	gthis
->
	gš™ed
 = 
ªÙh”Memb”
.
š™ed
;

167 
	gthis
->
	gšGroup
 = 
ªÙh”Memb”
.
šGroup
;

168 
	gthis
->
	gbFaed
 = 
ªÙh”Memb”
.
bFaed
;

169 
	gthis
->
	gÂb
 = 
ªÙh”Memb”
.
Âb
;

170 
	gthis
->
	gh—¹b—t
 = 
ªÙh”Memb”
.
h—¹b—t
;

171 
	gthis
->
	gpšgCouÁ”
 = 
ªÙh”Memb”
.
pšgCouÁ”
;

172 
	gthis
->
	gtimeOutCouÁ”
 = 
ªÙh”Memb”
.
timeOutCouÁ”
;

173 
	gthis
->
	gmemb”Li¡
 = 
ªÙh”Memb”
.
memb”Li¡
;

174 
	gthis
->
	gmyPos
 = 
ªÙh”Memb”
.
myPos
;

175 
	gthis
->
	gmp1q
 = 
ªÙh”Memb”
.
mp1q
;

176  *
	gthis
;

	@Member.h

7 #iâdeà
MEMBER_H_


8 
	#MEMBER_H_


	)

10 
	~"¡dšşudes.h
"

17 şas 
	cq_–t
 {

18 
	mpublic
:

19 *
–t
;

20 
	msize
;

21 
q_–t
(*
–t
, 
size
);

29 şas 
	cAdd»ss
 {

30 
	mpublic
:

31 
addr
[6];

32 
	$Add»ss
() {}

34 
	`Add»ss
(cÚ¡ 
Add»ss
 &
ªÙh”Add»ss
);

36 
Add»ss
& 
İ”©Ü
 =(cÚ¡ Add»s &
ªÙh”Add»ss
);

37 
boŞ
 
İ”©Ü
 ==(cÚ¡ 
Add»ss
 &
ªÙh”Add»ss
);

38 
	$Add»ss
(
¡ršg
 
add»ss
) {

39 
size_t
 
pos
 = 
add»ss
.
	`fšd
(":");

40 
id
 = 
	`¡oi
(
add»ss
.
	`sub¡r
(0, 
pos
));

41 
pÜt
 = ()
	`¡oi
(
add»ss
.
	`sub¡r
(
pos
 + 1,‡dd»ss.
	`size
()-pos-1));

42 
	`memıy
(&
addr
[0], &
id
, ());

43 
	`memıy
(&
addr
[4], &
pÜt
, ());

44 
	}
}

45 
¡ršg
 
	$g‘Add»ss
() {

46 
id
 = 0;

47 
pÜt
;

48 
	`memıy
(&
id
, &
addr
[0], ());

49 
	`memıy
(&
pÜt
, &
addr
[4], ());

50  
	`to_¡ršg
(
id
è+ ":" +o_¡ršg(
pÜt
);

51 
	}
}

52 
	$š™
() {

53 
	`mem£t
(&
addr
, 0, (addr));

54 
	}
}

62 şas 
	cMemb”Li¡EÁry
 {

63 
	mpublic
:

64 
id
;

65 
	mpÜt
;

66 
	mh—¹b—t
;

67 
	mtime¡amp
;

68 
Memb”Li¡EÁry
(
id
, 
pÜt
, 
h—¹b—t
, 
time¡amp
);

69 
Memb”Li¡EÁry
(
id
, 
pÜt
);

70 
	$Memb”Li¡EÁry
(): 
	`id
(0), 
	`pÜt
(0), 
	`h—¹b—t
(0), 
	$time¡amp
(0) {}

71 
	`Memb”Li¡EÁry
(cÚ¡ 
Memb”Li¡EÁry
 &
ªÙh”MLE
);

72 
Memb”Li¡EÁry
& 
İ”©Ü
 =(cÚ¡ Memb”Li¡EÁry &
ªÙh”MLE
);

73 
	`g‘id
();

74 
	`g‘pÜt
();

75 
	`g‘h—¹b—t
();

76 
	`g‘time¡amp
();

77 
	`£tid
(
id
);

78 
	`£Üt
(
pÜt
);

79 
	`£th—¹b—t
(
h—rb—t
);

80 
	`£‰ime¡amp
(
time¡amp
);

81 
	}
};

89 şas 
	cMemb”
 {

90 
	mpublic
:

92 
Add»ss
 
addr
;

94 
boŞ
 
	mš™ed
;

96 
boŞ
 
	mšGroup
;

98 
boŞ
 
	mbFaed
;

100 
	mÂb
;

102 
	mh—¹b—t
;

104 
	mpšgCouÁ”
;

106 
	mtimeOutCouÁ”
;

108 
	mveùÜ
<
	mMemb”Li¡EÁry
> 
	mmemb”Li¡
;

110 
	mveùÜ
<
	mMemb”Li¡EÁry
>::
™”©Ü
 
myPos
;

112 
	mqueue
<
	mq_–t
> 
	mmp1q
;

116 
	$Memb”
(): 
	`š™ed
(
çl£
), 
	`šGroup
(çl£), 
	`bFaed
(çl£), 
	`Âb
(0), 
	`h—¹b—t
(0), 
	`pšgCouÁ”
(0), 
	$timeOutCouÁ”
(0) {}

118 
	`Memb”
(cÚ¡ 
Memb”
 &
ªÙh”Memb”
);

120 
Memb”
& 
İ”©Ü
 =(cÚ¡ Memb” &
ªÙh”Memb”
);

121 
vœtu®
 ~
	$Memb”
(è{
	}
}

	@Params.cpp

7 
	~"P¬ams.h
"

12 
	gP¬ams
::
	$P¬ams
(): 
	$PORTNUM
(8001è{
	}
}

19 
P¬ams
::
	$£¬ams
(*
cÚfig_fe
) {

20 
FILE
 *
å
 = 
	`fİ’
(
cÚfig_fe
,"r");

22 
	`fsÿnf
(
å
,"MAX_NNB: %d", &
MAX_NNB
);

23 
	`fsÿnf
(
å
,"\nSINGLE_FAILURE: %d", &
SINGLE_FAILURE
);

24 
	`fsÿnf
(
å
,"\nDROP_MSG: %d", &
DROP_MSG
);

25 
	`fsÿnf
(
å
,"\nMSG_DROP_PROB: %lf", &
MSG_DROP_PROB
);

29 
EN_GPSZ
 = 
MAX_NNB
;

30 
STEP_RATE
=.25;

31 
MAX_MSG_SIZE
 = 4000;

32 
glob®time
 = 0;

33 
drİmsg
 = 0;

34 
®lNodesJošed
 = 0;

35  
i
 = 0; i < 
EN_GPSZ
; i++ ) {

36 
®lNodesJošed
 +ğ
i
;

38 
	`fşo£
(
å
);

40 
	}
}

48 
	gP¬ams
::
	$g‘cu¼time
(){

49  
glob®time
;

50 
	}
}

	@Params.h

7 #iâdeà
_PARAMS_H_


8 
	#_PARAMS_H_


	)

10 
	~"¡dšşudes.h
"

11 
	~"P¬ams.h
"

12 
	~"Memb”.h
"

14 
	e‹¡TYPE
 { 
	mCREATE_TEST
, 
	mREAD_TEST
, 
	mUPDATE_TEST
, 
	mDELETE_TEST
 };

21 şas 
	cP¬ams
{

22 
	mpublic
:

23 
MAX_NNB
;

24 
	mSINGLE_FAILURE
;

25 
	mMSG_DROP_PROB
;

26 
	mSTEP_RATE
;

27 
	mEN_GPSZ
;

28 
	mMAX_MSG_SIZE
;

29 
	mDROP_MSG
;

30 
	mdrİmsg
;

31 
	mglob®time
;

32 
	m®lNodesJošed
;

33 
	mPORTNUM
;

34 
P¬ams
();

35 
£¬ams
(*);

36 
g‘cu¼time
();

	@Queue.h

7 #iâdeà
QUEUE_H_


8 
	#QUEUE_H_


	)

10 
	~"¡dšşudes.h
"

11 
	~"Memb”.h
"

18 şas 
	cQueue
 {

19 
	mpublic
:

20 
	$Queue
() {}

21 
vœtu®
 ~
	$Queue
(è{
	}
}

22 
boŞ
 
’queue
(
queue
<
q_–t
> *queue, *
bufãr
, 
size
) {

23 
q_–t
 
–em’t
(
bufãr
, 
size
);

24 
	gqueue
->
em¶aû
(
–em’t
);

25  
	gŒue
;

	@stdincludes.h

7 #iâdeà
_STDINCLUDES_H_


8 
	#_STDINCLUDES_H_


	)

13 
	#RING_SIZE
 512

	)

14 
	#FAILURE
 -1

	)

15 
	#SUCCESS
 0

	)

20 
	~<¡dio.h
>

21 
	~<m©h.h
>

22 
	~<¡ršg.h
>

23 
	~<¡dlib.h
>

24 
	~<as£¹.h
>

25 
	~<time.h
>

26 
	~<¡d¬g.h
>

27 
	~<uni¡d.h
>

28 
	~<fú.h
>

29 
	~<execšfo.h
>

30 
	~<sigÇl.h
>

31 
	~<io¡»am
>

32 
	~<veùÜ
>

33 
	~<m­
>

34 
	~<¡ršg
>

35 
	~<®gÜ™hm
>

36 
	~<queue
>

37 
	~<f¡»am
>

39 
usšg
 
Çme¥aû
 
	g¡d
;

41 
	#STDCLLBKARGS
 (*
’v
, *
d©a
, 
size
)

	)

42 
	#STDCLLBKRET
 

	)

43 
	#DEBUGLOG
 1

	)

	@
1
.
0
14
150
Application.cpp
Application.h
EmulNet.cpp
EmulNet.h
Log.cpp
Log.h
MP1Node.cpp
MP1Node.h
Member.cpp
Member.h
Params.cpp
Params.h
Queue.h
stdincludes.h
